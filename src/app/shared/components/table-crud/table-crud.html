<div class="p-4 w-ful bg-base-200 border border-base-300 rounded-lg">
  <div class="flex justify-between items-center mb-4">
    <input
      type="text"
      placeholder="Buscar en la tabla..."
      [(ngModel)]="filterValue"
      (input)="applyFilter()"
      class="dinput dinput-bordered w-full max-w-xs"
    />
    <div class="flex gap-2">
      <button (click)="exportToCsv()" class="dbtn">Exportar a CSV</button>
      <button (click)="createNew()" class="dbtn dbtn-primary">Crear Nuevo</button>
    </div>
  </div>

  <div class="overflow-x-auto">
    <table class="dtable dtable-zebra">
      <thead>
        <tr>
          @for (col of columns(); track $index) {
            <th>
              <div class="flex items-center gap-2">
                <span>{{ col.label }}</span>
                @if (col.sortable !== false) {
                  <button (click)="onSort(col.key)" class="dbtn dbtn-ghost dbtn-xs">
                    @if (sortColumn === col.key) {
                      <span class="material-symbols-outlined" style="font-size: large;">{{
                        sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward'
                      }}</span>
                    } @else {
                      <span class="material-symbols-outlined" style="font-size: large;">swap_vert</span>
                    }
                  </button>
                }
              </div>
              <input
                type="text"
                placeholder="Filtrar..."
                [(ngModel)]="columnFilters[col.key]"
                (input)="updateData()"
                class="dinput dinput-bordered dinput-xs w-full mt-1"
              />
            </th>
          }
          <th class="text-right">Acciones</th>
        </tr>
      </thead>

      <tbody>
        @for (item of paginatedData; track $index) {
          <tr>
            @for (col of columns(); track col.key) {
              <td>
              @switch (col.dataType) {
                @case ('date') {
                  {{ getValue(item, col.key) | date: 'dd/MM/yyyy HH:mm' }}
                }
                @case ('boolean') {
                  @if (getValue(item, col.key)) {
                    <span class="material-symbols-outlined text-success">check_circle</span>
                  } @else {
                    <span class="material-symbols-outlined text-error">cancel</span>
                  }
                }
                @default {
                  {{ getValue(item, col.key) }}
                }
              }
            </td>
            }
            <td class="text-right">
              <div class="flex justify-end gap-2">
                <button (click)="editRow(item)" class="dbtn dbtn-neutral dbtn-xs">Editar</button>
                <!-- <button (click)="deleteRow(item)" class="dbtn dbtn-error dbtn-xs">Eliminar</button> -->
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Paginación -->
  <div class="flex justify-between items-center mt-4">
    <div>
      <span class="text-sm text-base-content"
        >Página {{ currentPage }} de {{ totalPages }}</span
      >
    </div>
    <div class="join">
      <button (click)="previousPage()" [disabled]="currentPage === 1" class="join-item dbtn">«</button>
      <button class="join-item dbtn">Página {{ currentPage }}</button>
      <button (click)="nextPage()" [disabled]="currentPage === totalPages" class="join-item dbtn">»</button>
    </div>
    <div>
      <select title="select_paginator" [(ngModel)]="itemsPerPage" (change)="updateData()" class="dselect dselect-bordered">
        <option [ngValue]="10">10 por página</option>
        <option [ngValue]="25">25 por página</option>
        <option [ngValue]="50">50 por página</option>
      </select>
    </div>
  </div>

  @if (data() && !filteredData.length) {
    <div role="alert" class="alert alert-warning mt-4">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="stroke-current shrink-0 h-6 w-6"
        fill="none"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
        />
      </svg>
      <span>No hay resultados que coincidan con la búsqueda.</span>
    </div>
  } @else if (!data()?.length) {
    <div role="alert" class="alert alert-info mt-4">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        class="stroke-current shrink-0 w-6 h-6"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
        ></path>
      </svg>
      <span>No hay datos para mostrar. Puede crear un nuevo registro.</span>
    </div>
  }
</div>
