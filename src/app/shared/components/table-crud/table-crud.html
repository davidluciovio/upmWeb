<div
	class="p-4 h-fit flex flex-col bg-surface-200 dark:bg-surface-900 shadow-sm rounded-xl border border-surface-200 dark:border-surface-700 overflow-hidden"
>
	<p-table
		#dt
		[value]="data()"
		[columns]="pTableColumns()"
		[rows]="10"
		[paginator]="true"
		[rowsPerPageOptions]="[10, 25, 50, 100]"
		paginatorDropdownAppendTo="body"
		[globalFilterFields]="globalFilterFields()"
		[tableStyle]="{ 'min-width': '50rem' }"
		size="small"
		[rowHover]="true"
		dataKey="id"
		currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros"
		[showCurrentPageReport]="true"
		paginatorStyleClass="mb-4"
	>
		<ng-template pTemplate="caption">
			<div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 p-2">
				<p-iconField iconPosition="left" class="w-full md:w-auto">
					<span
						class="material-symbols-outlined absolute top-1/2 left-3 -translate-y-1/2 text-surface-500"
						style="font-size: 1.2rem; pointer-events: none"
					>
						search
					</span>
					<input pInputText type="text" (input)="onGlobalFilter(dt, $event)" placeholder="Buscar..." class="w-full md:w-64 pl-10 p-inputtext-sm" />
				</p-iconField>

				<div class="flex gap-2">
					<p-button (onClick)="exportToCsv()" severity="secondary" [outlined]="true" size="small">
						<div class="flex align-items-center gap-2">
							<span class="material-symbols-outlined text-lg">ios_share</span>
							<span class="font-medium">Exportar</span>
						</div>
					</p-button>

					<p-button (onClick)="createNew()" size="small">
						<div class="flex align-items-center gap-2">
							<span class="material-symbols-outlined text-lg">add</span>
							<span class="font-medium">Nuevo</span>
						</div>
					</p-button>
				</div>
			</div>
		</ng-template>

		<ng-template pTemplate="header" let-columns>
			<tr class="bg-surface-200 dark:bg-surface-800/50 border-b border-surface-200 dark:border-surface-700">
				@for (col of columns; track col.key) {
					<th [pSortableColumn]="col.sortable !== false ? col.key : null" class="whitespace-nowrap py-3 px-4">
						<div class="flex align-items-center text-center gap-2 text-surface-600 dark:text-surface-200 text-sm font-semibold">
							{{ col.label }}

							@if (col.sortable !== false) {
								<p-sortIcon [field]="col.key"></p-sortIcon>
							}

							@if (col.active !== false) {
								<p-columnFilter
									[type]="col.dataType === 'number' ? 'numeric' : col.dataType === 'date' ? 'date' : col.dataType === 'boolean' ? 'boolean' : 'text'"
									[field]="col.key"
									display="menu"
									class="ml-auto opacity-50 hover:opacity-100 transition-opacity"
								>
									<ng-template pTemplate="filtericon">
										<span class="material-symbols-outlined text-sm">filter_alt</span>
									</ng-template>
								</p-columnFilter>
							}
						</div>
					</th>
				}
				<th style="width: 100px" class="text-right py-3 px-4 text-surface-600 dark:text-surface-200 text-sm font-semibold">Acciones</th>
			</tr>
		</ng-template>

		<ng-template pTemplate="body" let-rowData let-columns="columns">
			<tr class="border-b border-surface-50 dark:border-surface-800 hover:bg-surface-50 dark:hover:bg-surface-800/50 transition-colors">
				@for (col of columns; track col.key) {
					<td class="py-3 px-4 text-sm text-surface-700 dark:text-surface-0">
						@switch (col.dataType) {
							@case ('date') {
								{{ getValue(rowData, col.key) | date: 'dd/MM/yyyy HH:mm' }}
							}

							@case ('boolean') {
								@if (getValue(rowData, col.key)) {
									<span class="material-symbols-outlined text-xs mr-1" ngClass="text-green-500">check_circle</span>
								} @else {
									<span class="material-symbols-outlined text-xs mr-1" ngClass="text-red-500">cancel</span>
								}
							}

							@default {
								<span [title]="getValue(rowData, col.key)" class="font-medium">
									{{ getValue(rowData, col.key) }}
								</span>
							}
						}
					</td>
				}

				<td class="text-right py-3 px-4">
					<p-button [rounded]="true" [text]="true" severity="secondary" size="small" pTooltip="Editar" tooltipPosition="left" (onClick)="editRow(rowData)">
						<span class="material-symbols-outlined" style="font-size: 1.2rem">edit</span>
					</p-button>
				</td>
			</tr>
		</ng-template>

		<ng-template pTemplate="emptymessage">
			<tr>
				<td [attr.colspan]="columns().length + 1" class="text-center py-8">
					<div class="flex flex-col items-center justify-center opacity-70">
						<div class="bg-surface-100 dark:bg-surface-800 rounded-full p-4 mb-3">
							<span class="material-symbols-outlined text-4xl text-surface-500">search_off</span>
						</div>
						<span class="text-lg font-bold text-surface-900 dark:text-surface-0">Sin resultados</span>
						<p class="text-surface-500 mb-4 text-sm">No se encontraron registros coincidentes.</p>

						<p-button (onClick)="createNew()" size="small" [outlined]="true">
							<div class="flex align-items-center gap-2">
								<span class="material-symbols-outlined text-sm">add</span>
								<span>Crear Nuevo</span>
							</div>
						</p-button>
					</div>
				</td>
			</tr>
		</ng-template>
	</p-table>
</div>
