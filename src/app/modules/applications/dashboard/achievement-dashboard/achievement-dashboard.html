<nav class="bg-[#002855] text-white p-4 shadow-md border-b-4 border-[#bf9110] sticky top-0 z-50">
	<div class="container mx-auto flex justify-between items-center">
		<h1 class="text-xl font-bold tracking-tight uppercase flex items-center gap-3">
			<span class="border-r border-white/30 pr-3 italic">ACHIEVEMENT DASHBOARD</span>
			<span class="text-sm font-normal hidden md:inline opacity-70">目標達成率管理</span>
		</h1>
		<div class="text-[10px] uppercase font-bold tracking-widest bg-white/10 px-3 py-1 rounded">Unipres Mexicana</div>
	</div>
</nav>

<main class="container mx-auto p-4 md:p-8 space-y-6 flex flex-col gap-6">
	<app-dashboard-filters
		[areas]="areas()"
		[supervisors]="supervisors()"
		[leaders]="leaders()"
		[parts]="parts()"
		(filterChange)="onFiltersChange($event)"
	>  
	</app-dashboard-filters>

	@if (isLoading()) {
		<div class="w-full h-96 flex flex-col gap-4 items-center justify-center">
			<span class="loading loading-dots loading-lg text-primary"></span>
			<div class="text-center animate-pulse">
				<p class="text-lg font-bold text-[#002855]">Cargando datos del tablero...</p>
				<p class="text-xs text-base-content/50 uppercase tracking-widest">Loading Dashboard Data / データを読み込んでいます</p>
			</div>
		</div>
	} @else {
		<app-kpi-cards [globalAchievement]="kpis().ach" [totalReal]="kpis().totalReal" [totalObj]="kpis().totalObj" [difference]="kpis().diff">
		</app-kpi-cards>

		<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 min-h-[500px]">
			<app-hierarchy-table [data]="hierarchyData()" (openDetail)="detailModal.open($event)"> </app-hierarchy-table>
			<app-parts-table [data]="partsData()" (openDetail)="detailModal.open($event)"> </app-parts-table>
		</div>

		<div class="flex flex-col gap-8">
			<section class="bg-base-100 p-6 rounded-xl shadow-sm border border-base-300 flex flex-col transition-all">
				<div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
					<div>
						<h3 class="font-bold text-base-content uppercase text-sm tracking-widest flex items-center gap-2">
							<div class="w-2 h-4 bg-blue-600 rounded-sm"></div>
							Tendencia de Cumplimiento
						</h3>
						<p class="text-[10px] text-base-content/40 mt-1 uppercase tracking-tight">Daily Achievement Trend</p>
					</div>

					<div class="flex rounded-md border border-base-300 bg-base-100 p-1">
						<button
							(click)="trendViewMode.set('general')"
							[class.bg-[#002855]]="trendViewMode() === 'general'"
							[class.text-white]="trendViewMode() === 'general'"
							class="px-3 py-1 text-[9px] font-bold uppercase rounded transition-colors"
						>
							General
						</button>
						<button
							(click)="trendViewMode.set('area')"
							[class.bg-[#002855]]="trendViewMode() === 'area'"
							[class.text-white]="trendViewMode() === 'area'"
							class="px-3 py-1 text-[9px] font-bold uppercase rounded transition-colors"
						>
							Áreas
						</button>
					</div>
				</div>

				<div class="flex min-h-[300px]">
					<chart [chartOptions]="trendChartOptions()"></chart>
				</div>
			</section>

			<section class="bg-base-100 p-6 rounded-xl shadow-sm border border-base-300 flex flex-col transition-all">
				<div class="mb-6">
					<h3 class="font-bold text-base-content uppercase text-sm tracking-widest flex items-center gap-2">
						<div class="w-2 h-4 bg-[#bf9110] rounded-sm"></div>
						Volumen: Obj vs Real / 生産量比較
					</h3>
					<p class="text-[10px] text-base-content/40 mt-1 uppercase tracking-tight">Production Volume Comparison</p>
				</div>
				<div class="flex grow min-h-[300px]">
					<chart [chartOptions]="comparisonChartOptions()"></chart>
				</div>
			</section>

			<section class="lg:col-span-2 bg-base-100 p-6 rounded-xl shadow-sm border border-base-300 transition-all">
				<div class="mb-6">
					<h3 class="font-bold text-base-content uppercase text-sm tracking-widest flex items-center gap-2">
						<div class="w-2 h-4 bg-emerald-500 rounded-sm"></div>
						Éxito por Parte / 成功率
					</h3>
					<p class="text-[10px] text-base-content/40 mt-1 uppercase tracking-tight">% de Partes que cumplieron objetivo diario</p>
				</div>
				<div class="min-h-[300px]">
					<chart [chartOptions]="successChartOptions()"></chart>
				</div>
			</section>
		</div>
	}
</main>

<app-detail-modal #detailModal />
